# -*- mode: python -*-
#
# Copyright (C) 2006, 2007, 2008 Imendio AB
#
# Build setup for creating frameworks against the 10.4 SDK. This file
# should normally not need any editing.
#
# Copy it or symlink it into ~/.jhbuildrc-cfw-10.4
#

prompt_prefix = "*CFW*"

modules = [
         "meta-gtk-osx-bootstrap",
         "meta-gtk-osx-core",
         "meta-gtk-osx-themes",
         #"meta-gstreamer",
         #"meta-webkit-deps",
         "libglade",
         "loudmouth"
         ]

# Source and installation locations.
#
root = os.path.expanduser("~/Source/create-gtk-fw")
checkoutroot = os.path.join(root, "source")
prefix = os.path.join(root, "inst")

sdkdir = setup_sdk_10_4()

# Needed to get the various sublibraries to find and use the same
# symbols.
#
environ_append('LDFLAGS', '-Wl,-flat_namespace')

# Need to point some modules to the right place so we don't pick up
# things from /usr/lib.
#
module_autogenargs["gettext"] = autogenargs + " --with-libiconv-prefix=" + sdkdir + "/usr"
module_autogenargs["libxml2"] = autogenargs + " --with-iconv=" + sdkdir + "/usr" + " --with-zlib=" + sdkdir + "/usr" 
module_autogenargs["libxslt"] = autogenargs + " --with-libxml-prefix=" + prefix

# For unknown reasons, iconv is not picked up correctly without this
# (possibly due to using -flat_namespace....).
#
old_value = module_autogenargs.get('glib', autogenargs)
module_autogenargs['glib'] = old_value + ' --with-libiconv=gnu'

# Use latest stable branches for some modules. Keep any overriden repo
# name here to keep custom usernames set up in a -custom setup.
#
repo = repos.get("svn.gnome.org", "http://svn.gnome.org/svn")
if repo.endswith("/"):
    repo = repo[:-1]

branches["glib"] = repo + "/glib/branches/glib-2-16"
branches["gtk+"] = repo + "/gtk+/branches/gtk-2-12"
branches["atk"] = repo + "/atk/branches/gnome-2-22"
#branches["pango"] = repo + "/pango/branches/pango-1-20"

# Skip those for now.
#
skip.append("gst-plugins-ugly")
skip.append("gst-plugins-bad")
skip.append("gst-ffmpeg")
skip.append("faad")

# We build those as frameworks instead.
#
skip.append("glib")
skip.append("pango")
skip.append("atk")
skip.append("cairo")
skip.append("gtk+")
skip.append("ige-mac-integration")
skip.append("gtk-engines")
skip.append("libglade")
skip.append("loudmouth")

# Not needed.
#
skip.append("libcurl")
skip.append("bison")
skip.append("waf")
skip.append("pyxml")
skip.append("automake-1.4")
skip.append("tango-icon-theme")
skip.append("tango-icon-theme-extras")

# Use libxml/libxslt from the system.
#
skip.append("libxml2")
skip.append("libxslt")

# Needed to pick up libxml2 and libxslt from the system.
#
addpath("PKG_CONFIG_PATH", "/usr/lib/pkgconfig")

# We want the system perl and python, not from macports or so.
os.environ["PERL"] = "/usr/bin/perl"
os.environ["PYTHON"] = "/usr/bin/python"
